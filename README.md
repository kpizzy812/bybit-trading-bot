# Bybit Trading Bot

Telegram-–±–æ—Ç –¥–ª—è —Ç—Ä–µ–π–¥–∏–Ω–≥–∞ –Ω–∞ Bybit —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ä–∏—Å–∫–∞–º–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π AI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏** –æ—Ç —Ä–∏—Å–∫–∞ (`qty = risk_$ / |entry - stop|`)
- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ SL/TP** –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥–µ
- **Trade Wizard** - –ø–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–¥–µ–ª–∫–∏
- **AI Scenarios** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Syntra AI –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞
- **Position Monitor** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∑–∏—Ü–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- **Auto Breakeven** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–Ω–æ—Å SL –Ω–∞ entry –ø–æ—Å–ª–µ TP1
- **Post-SL Analysis** - –∞–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ü–µ–Ω—ã –ø–æ—Å–ª–µ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞
- **Trade History** - –∂—É—Ä–Ω–∞–ª –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- **Testnet/Live —Ä–µ–∂–∏–º—ã** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏
- **–ó–∞—â–∏—Ç–∞ –æ—Ç race conditions** —Å Redis locks
- **–¢–æ—á–Ω–æ–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ** —á–µ—Ä–µ–∑ Decimal

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- BTCUSDT
- ETHUSDT
- SOLUSDT
- BNBUSDT
- HYPEUSDT

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repo-url>
cd "Futures Bot"
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
python3 -m venv venv
source venv/bin/activate  # –ù–∞ Windows: venv\Scripts\activate
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:

```bash
# Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É @BotFather)
TELEGRAM_BOT_TOKEN=your_bot_token_here

# Bybit API Keys (–¢–û–õ–¨–ö–û Trade –ø—Ä–∞–≤–∞, –ë–ï–ó Withdraw!)
BYBIT_API_KEY=your_api_key_here
BYBIT_API_SECRET=your_api_secret_here

# Bybit Testnet API (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
BYBIT_TESTNET_API_KEY=your_testnet_api_key_here
BYBIT_TESTNET_API_SECRET=your_testnet_api_secret_here

# Owner ID (—Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞)
OWNER_TELEGRAM_ID=123456789

# Syntra AI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è AI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏)
SYNTRA_API_URL=http://localhost:8000
SYNTRA_API_KEY=
SYNTRA_API_TIMEOUT=180
AI_SCENARIOS_ENABLED=true

# Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# Bot Settings
DEFAULT_TESTNET_MODE=true
LOG_LEVEL=INFO
```

### 5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

Redis –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
- –•—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Trade locks (–∑–∞—â–∏—Ç–∞ –æ—Ç race conditions)
- FSM storage (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**macOS:**
```bash
brew install redis
brew services start redis
```

**Ubuntu/Debian:**
```bash
sudo apt-get install redis-server
sudo systemctl start redis
```

**–ë–µ–∑ Redis:**
–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

## –ó–∞–ø—É—Å–∫

```bash
python main.py
```

–õ–æ–≥–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ `bot.log`.

## –ü–æ–ª—É—á–µ–Ω–∏–µ Bybit API –∫–ª—é—á–µ–π

### Testnet (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [Bybit Testnet](https://testnet.bybit.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ API Management
3. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á —Å –ø—Ä–∞–≤–∞–º–∏ **—Ç–æ–ª—å–∫–æ Trade** (–ë–ï–ó Withdraw!)
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ API Key –∏ API Secret –≤ `.env`

### Live (–¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [Bybit.com](https://www.bybit.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ API Management
3. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á —Å –ø—Ä–∞–≤–∞–º–∏ **—Ç–æ–ª—å–∫–æ Trade** (–ë–ï–ó Withdraw!)
4. –í–∫–ª—é—á–∏—Ç–µ IP whitelist –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ API Key –∏ API Secret –≤ `.env`

**‚ö†Ô∏è –í–ê–ñ–ù–û:**
- API –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¢–û–õ–¨–ö–û –ø—Ä–∞–≤–∞ Trade
- –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–∞–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∞ Withdraw
- –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å Testnet –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
/start
```

–í—ã —É–≤–∏–¥–∏—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏:
- ‚ûï –û—Ç–∫—Ä—ã—Ç—å —Å–¥–µ–ª–∫—É
- ü§ñ AI Scenarios - AI-–∞–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞
- üìä –ü–æ–∑–∏—Ü–∏–∏
- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- üßæ –ò—Å—Ç–æ—Ä–∏—è
- üß™ Testnet/Live

### 2. –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–∫–∏

–ù–∞–∂–º–∏—Ç–µ "‚ûï –û—Ç–∫—Ä—ã—Ç—å —Å–¥–µ–ª–∫—É" –∏ —Å–ª–µ–¥—É–π—Ç–µ –≤–∏–∑–∞—Ä–¥—É:

1. **–í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:** BTCUSDT, ETHUSDT, SOLUSDT, etc.
2. **–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** Long –∏–ª–∏ Short
3. **–¢–∏–ø –≤—Ö–æ–¥–∞:** Market –∏–ª–∏ Limit
4. **–°—Ç–æ–ø:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Ü–µ–Ω–∞ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞
5. **–†–∏—Å–∫ –∏ –ø–ª–µ—á–æ:** $5/$10/$15, 2x/3x/5x
6. **–¢–µ–π–∫–∏:** Single TP, Ladder –∏–ª–∏ –ø–æ RR
7. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–¥–µ–ª–∫–∏

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∑–∏—Ü–∏–π

–ù–∞–∂–º–∏—Ç–µ "üìä –ü–æ–∑–∏—Ü–∏–∏" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:
- –û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π —Å PnL
- Unrealized/Realized PnL
- SL/TP —Å—Ç–∞—Ç—É—Å—ã
- –î–µ–π—Å—Ç–≤–∏—è: –ø–µ—Ä–µ–¥–≤–∏–Ω—É—Ç—å SL, —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–∫—Ä—ã—Ç—å, –∑–∞–∫—Ä—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∏

–ù–∞–∂–º–∏—Ç–µ "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏" –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- –î–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ä–∏—Å–∫ ($5, $10, $15)
- –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –ø–ª–µ—á–æ (2x, 3x, 5x)
- –†–µ–∂–∏–º –º–∞—Ä–∂–∏ (Isolated/Cross)
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —à–æ—Ä—Ç–æ–≤
- –®–∞–±–ª–æ–Ω TP (RR/ladder/single)
- –õ–∏–º–∏—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–º–∞–∫—Å. —Ä–∏—Å–∫/–º–∞—Ä–∂–∞)

### 5. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ Testnet/Live

–ù–∞–∂–º–∏—Ç–µ "üß™ Testnet/Live" –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞.

**‚ö†Ô∏è –í–°–ï–ì–î–ê —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ Testnet –ø–µ—Ä–µ–¥ Live!**

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
futures-bot/
‚îú‚îÄ‚îÄ config.py                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py           # /start –∫–æ–º–∞–Ω–¥–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ menu.py            # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ positions.py       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ history.py         # –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai_scenarios.py    # AI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (Syntra AI)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trade_wizard/      # –ü–æ—à–∞–≥–æ–≤–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–∫–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ symbol_side.py # –í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ entry.py       # –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ stop.py        # –°—Ç–æ–ø-–ª–æ—Å—Å
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ risk_leverage.py # –†–∏—Å–∫ –∏ –ø–ª–µ—á–æ
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ take_profit.py # –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ confirmation.py # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ navigation.py  # –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∏–∑–∞—Ä–¥—É
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ utils.py       # –£—Ç–∏–ª–∏—Ç—ã –≤–∏–∑–∞—Ä–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/             # Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main_menu.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trade_kb.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ positions_kb.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings_kb.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ history_kb.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai_scenarios_kb.py
‚îÇ   ‚îú‚îÄ‚îÄ states/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trade_states.py    # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ middlewares/
‚îÇ       ‚îî‚îÄ‚îÄ owner_check.py     # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ bybit/                 # Bybit API V5
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.py          # Base client
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orders.py          # –†–∞–±–æ—Ç–∞ —Å –æ—Ä–¥–µ—Ä–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ positions.py       # –†–∞–±–æ—Ç–∞ —Å –ø–æ–∑–∏—Ü–∏—è–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trading_stop.py    # SL/TP
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ wallet.py          # –ë–∞–ª–∞–Ω—Å
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ market_data.py     # –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îú‚îÄ‚îÄ risk_calculator.py     # –†–∞—Å—á—ë—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ position_monitor.py    # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∑–∏—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ order_monitor.py       # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ä–¥–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ breakeven_manager.py   # Auto Breakeven
‚îÇ   ‚îú‚îÄ‚îÄ trade_logger.py        # –ñ—É—Ä–Ω–∞–ª —Å–¥–µ–ª–æ–∫ (Redis)
‚îÇ   ‚îú‚îÄ‚îÄ post_sl_analyzer.py    # –ê–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ SL
‚îÇ   ‚îî‚îÄ‚îÄ syntra_client.py       # –ö–ª–∏–µ–Ω—Ç Syntra AI API
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îî‚îÄ‚îÄ user_settings.py       # Redis storage + trade locks
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ validators.py          # Decimal-–æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ, –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îî‚îÄ‚îÄ docs/
    ‚îî‚îÄ‚îÄ AI_ANALYSIS/           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ Syntra AI
```

## –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ —Ä–∏—Å–∫–∞

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
qty = risk_usd / abs(entry_price - stop_price)
margin = (qty * entry_price) / leverage

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
# qty = risk_usd / (abs(entry_price - stop_price) * leverage)  # leverage –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ PnL!
```

### 2. –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Decimal

```python
from decimal import Decimal, ROUND_DOWN

def round_qty(qty: float, qty_step: float) -> str:
    qty_dec = Decimal(str(qty))
    step_dec = Decimal(str(qty_step))
    rounded = (qty_dec / step_dec).quantize(Decimal('1'), rounding=ROUND_DOWN) * step_dec
    return str(rounded)
```

**‚ö†Ô∏è –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `qty % qty_step` - –¥–∞—ë—Ç float –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã!**

### 3. wait_until_filled() –¥–ª—è Market –æ—Ä–¥–µ—Ä–æ–≤

```python
# avgPrice –º–æ–∂–µ—Ç –±—ã—Ç—å 0 —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ place_order
# –ù—É–∂–µ–Ω retry —Å timeout
order = await bybit.wait_until_filled(order_id, timeout=10)
avg_price = float(order['avgPrice'])
```

### 4. Race Condition Protection

```python
# Redis lock –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Å–¥–µ–ª–∫–∏
if not await lock_manager.acquire_lock(user_id):
    await message.answer("‚è≥ Trade in progress...")
    return

try:
    # ... –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ ...
finally:
    await lock_manager.release_lock(user_id)
```

### 5. –õ–∏–∫–≤–∏–¥–∞—Ü–∏—è - –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `liqPrice` –∏–∑ API –ø–æ–∑–∏—Ü–∏–∏, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ.
–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ —á–∞—Å—Ç–æ –Ω–µ—Ç–æ—á–Ω–∞.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ API –∫–ª—é—á –¢–û–õ–¨–ö–û —Å –ø—Ä–∞–≤–∞–º–∏ Trade (–ë–ï–ó Withdraw)
‚úÖ –í—Å–µ –∫–ª—é—á–∏ –≤ .env (–ù–ï –≤ –∫–æ–¥–µ, –¥–æ–±–∞–≤–∏—Ç—å .env –≤ .gitignore)
‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π confirm step –ø–µ—Ä–µ–¥ —Å–¥–µ–ª–∫–æ–π
‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–∞–±–ª-–∫–ª–∏–∫–∞: `clientOrderId = uuid4()`
‚úÖ –õ–∏–º–∏—Ç—ã –Ω–∞ –º–∞–∫—Å. —Ä–∏—Å–∫/–º–∞—Ä–∂—É
‚úÖ –ù–∞—á–∏–Ω–∞—Ç—å —Å Testnet
‚úÖ Rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ (–µ—Å–ª–∏ SL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è ‚Üí –∑–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é)

## –°—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- Bybit API V5 client (orders, positions, wallet, market data)
- Risk calculator —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ñ–æ—Ä–º—É–ª–æ–π
- Trade Wizard (–ø–æ–ª–Ω—ã–π flow –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–¥–µ–ª–∫–∏)
- Position management (–ø—Ä–æ—Å–º–æ—Ç—Ä, –∑–∞–∫—Ä—ã—Ç–∏–µ, –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏–µ SL)
- User settings (—Ä–∏—Å–∫, –ø–ª–µ—á–æ, –º–∞—Ä–∂–∞, TP —Ä–µ–∂–∏–º—ã)
- Trade history —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- Position Monitor —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- Auto Breakeven –ø–æ—Å–ª–µ TP1
- Post-SL Analysis
- AI Scenarios (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Syntra AI)
- Owner-only —Ä–µ–∂–∏–º
- Redis storage + in-memory fallback

## Troubleshooting

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` —Ñ–∞–π–ª (—Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ –∏–∑ `.env.example`?)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_BOT_TOKEN`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: `pip install -r requirements.txt`

### "Insufficient balance" –æ—à–∏–±–∫–∞

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ Bybit (Testnet –∏–ª–∏ Live)
2. –£–º–µ–Ω—å—à–∏—Ç–µ —Ä–∏—Å–∫ –∏–ª–∏ –ø–ª–µ—á–æ
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (Testnet/Live)

### "Invalid qty/price" –æ—à–∏–±–∫–∞

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ qty –∏–ª–∏ price –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–∞–≤–∏–ª–∞–º Bybit (qtyStep, tickSize).
–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–∫—Ä—É–≥–ª—è–µ—Ç, –Ω–æ –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ instrument info –¥–ª—è —Å–∏–º–≤–æ–ª–∞
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –±–æ–ª—å—à–∏–π —Ä–∏—Å–∫ (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∏–∂–µ minNotional)

### Redis –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ fallback –Ω–∞ in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.
–î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Redis.

## Contributing

Pull requests are welcome! For major changes, please open an issue first.

## License

MIT

## Disclaimer

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:**

–≠—Ç–æ—Ç –±–æ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π.
–¢–æ—Ä–≥–æ–≤–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º–∏ —Å–æ–ø—Ä—è–∂–µ–Ω–∞ —Å –≤—ã—Å–æ–∫–∏–º —Ä–∏—Å–∫–æ–º.

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ —Å–≤–æ–π —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫
- –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å Testnet
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∏—Å–∫—É–π—Ç–µ –±–æ–ª—å—à–µ, —á–µ–º –º–æ–∂–µ—Ç–µ –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ –ø–æ—Ç–µ—Ä—è—Ç—å
- –ê–≤—Ç–æ—Ä –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –≤–∞—à–∏ —É–±—ã—Ç–∫–∏

**Trade responsibly!** üöÄ
